---
alwaysApply: true
---
Tech Stack Guidelines

Frontend: SvelteKit + Shadcn-Svelte (with Bits UI)

Svelte Components:

Use <script lang="ts">.

Use Svelte 5 Runes for reactivity:
- Props: `let { prop } = $props()` or `let { prop = $props().prop ?? defaultValue }`
- State: `let variable = $state(value)`
- Derived: `let derived = $derived(...)`
- Effects: `$effect(() => { ... })`

Use Context API for global state (User session) instead of Stores.

Use bind:this={element} instead of document.getElementById().

Components must be reactive. Avoid direct DOM manipulation outside of onMount.

Event handling: Use callback props instead of createEventDispatcher:
- `let { onSelect } = $props<{ onSelect?: (event: { url: string }) => void }>()`
- Call with: `onSelect?.({ url })`

Styling:

Use Tailwind CSS utility classes.

Use Shadcn-Svelte components (Button, Card, Input, Label, Alert, etc.) from `$lib/components/ui/`.

Use Bits UI components (Sheet, Collapsible, Separator) for layout structure.

Keep CSS in <style> blocks only for specific 3D-Canvas overlays that Tailwind cannot reach easily.

Data Fetching:

Use SvelteKit load functions in +page.server.ts for initial data.

Use standard fetch or a typed wrapper for API calls to the FastAPI backend.

Backend: FastAPI (Python)

Structure:

Modular router structure (/api/v1/simulation, /api/v1/files).

Use Dependency Injection (Depends) for Database sessions and Auth.

Typing:

STRICT use of Pydantic models for Request/Response schemas.

Type hint every function argument and return value.

Async:

All I/O bound operations (DB, S3 download) must be async def.

Heavy computations (Simulation) must run in BackgroundTasks or a Celery worker to not block the main loop.
